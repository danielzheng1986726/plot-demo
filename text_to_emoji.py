#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ–‡å­—è½¬ Emoji è½¬æ¢å™¨
å°†ç”¨æˆ·è¾“å…¥çš„ä¸­æ–‡æ–‡æœ¬è½¬æ¢ä¸ºåŒ…å« emoji è¡¨æƒ…çš„æ–‡æœ¬
"""

# Emoji æ˜ å°„å­—å…¸
EMOJI_MAP = {
    # æƒ…æ„Ÿç›¸å…³
    'å¼€å¿ƒ': 'ğŸ˜Š',
    'å¿«ä¹': 'ğŸ˜„',
    'é«˜å…´': 'ğŸ˜ƒ',
    'ç¬‘': 'ğŸ˜‚',
    'å¤§ç¬‘': 'ğŸ¤£',
    'å“ˆå“ˆ': 'ğŸ˜†',
    'å¾®ç¬‘': 'ğŸ™‚',
    'éš¾è¿‡': 'ğŸ˜¢',
    'ä¼¤å¿ƒ': 'ğŸ˜­',
    'å“­': 'ğŸ˜¿',
    'ç”Ÿæ°”': 'ğŸ˜ ',
    'æ„¤æ€’': 'ğŸ˜¡',
    'å®³æ€•': 'ğŸ˜¨',
    'ææƒ§': 'ğŸ˜±',
    'æƒŠè®¶': 'ğŸ˜®',
    'éœ‡æƒŠ': 'ğŸ˜²',
    'å–œæ¬¢': 'ğŸ˜',
    'çˆ±': 'â¤ï¸',
    'å¿ƒ': 'ğŸ’—',
    'äº²': 'ğŸ˜˜',
    'é…·': 'ğŸ˜',
    'æ€è€ƒ': 'ğŸ¤”',
    'å°´å°¬': 'ğŸ˜…',
    'æ— è¯­': 'ğŸ˜‘',
    'å›°': 'ğŸ˜´',
    'ç¡è§‰': 'ğŸ’¤',

    # åŠ¨ç‰©
    'çŒ«': 'ğŸ±',
    'ç‹—': 'ğŸ¶',
    'ç†Š': 'ğŸ»',
    'å…”': 'ğŸ°',
    'é¸Ÿ': 'ğŸ¦',
    'é¸¡': 'ğŸ”',
    'çŒª': 'ğŸ·',
    'ç‰›': 'ğŸ®',
    'é©¬': 'ğŸ´',
    'ç¾Š': 'ğŸ‘',
    'çŒ´': 'ğŸµ',
    'è€è™': 'ğŸ¯',
    'ç‹®å­': 'ğŸ¦',
    'ç†ŠçŒ«': 'ğŸ¼',
    'è€ƒæ‹‰': 'ğŸ¨',
    'é±¼': 'ğŸŸ',
    'é²¸é±¼': 'ğŸ‹',
    'æµ·è±š': 'ğŸ¬',
    'ä¼é¹…': 'ğŸ§',
    'è´è¶': 'ğŸ¦‹',
    'èœœèœ‚': 'ğŸ',

    # é£Ÿç‰©
    'è‹¹æœ': 'ğŸ',
    'é¦™è•‰': 'ğŸŒ',
    'è¥¿ç“œ': 'ğŸ‰',
    'è‘¡è„': 'ğŸ‡',
    'è‰è“': 'ğŸ“',
    'æ©™å­': 'ğŸŠ',
    'æŸ æª¬': 'ğŸ‹',
    'æ¡ƒ': 'ğŸ‘',
    'æ¨±æ¡ƒ': 'ğŸ’',
    'è›‹ç³•': 'ğŸ‚',
    'é¢åŒ…': 'ğŸ',
    'æ±‰å ¡': 'ğŸ”',
    'æŠ«è¨': 'ğŸ•',
    'çƒ­ç‹—': 'ğŸŒ­',
    'è–¯æ¡': 'ğŸŸ',
    'é¢æ¡': 'ğŸœ',
    'ç±³é¥­': 'ğŸš',
    'å¯¿å¸': 'ğŸ£',
    'é¥ºå­': 'ğŸ¥Ÿ',
    'å†°æ·‡æ·‹': 'ğŸ¦',
    'å’–å•¡': 'â˜•',
    'èŒ¶': 'ğŸµ',
    'å•¤é…’': 'ğŸº',
    'è›‹ç³•': 'ğŸ‚',
    'ç³–æœ': 'ğŸ¬',
    'å·§å…‹åŠ›': 'ğŸ«',

    # å¤©æ°”å’Œè‡ªç„¶
    'å¤ªé˜³': 'â˜€ï¸',
    'æœˆäº®': 'ğŸŒ™',
    'æ˜Ÿæ˜Ÿ': 'â­',
    'äº‘': 'â˜ï¸',
    'é›¨': 'ğŸŒ§ï¸',
    'é›ª': 'â„ï¸',
    'é—ªç”µ': 'âš¡',
    'å½©è™¹': 'ğŸŒˆ',
    'ç«': 'ğŸ”¥',
    'æ°´': 'ğŸ’§',
    'èŠ±': 'ğŸŒ¸',
    'ç«ç‘°': 'ğŸŒ¹',
    'æ ‘': 'ğŸŒ³',
    'å¶å­': 'ğŸƒ',
    'å±±': 'â›°ï¸',
    'æµ·': 'ğŸŒŠ',

    # äº¤é€šå·¥å…·
    'è½¦': 'ğŸš—',
    'æ±½è½¦': 'ğŸš™',
    'å…¬äº¤': 'ğŸšŒ',
    'é£æœº': 'âœˆï¸',
    'ç«è½¦': 'ğŸš‚',
    'åœ°é“': 'ğŸš‡',
    'è‡ªè¡Œè½¦': 'ğŸš²',
    'æ‘©æ‰˜è½¦': 'ğŸï¸',
    'èˆ¹': 'â›µ',
    'ç«ç®­': 'ğŸš€',

    # æ´»åŠ¨å’Œè¿åŠ¨
    'è¶³çƒ': 'âš½',
    'ç¯®çƒ': 'ğŸ€',
    'ç½‘çƒ': 'ğŸ¾',
    'ä¹’ä¹“çƒ': 'ğŸ“',
    'ç¾½æ¯›çƒ': 'ğŸ¸',
    'æ¸¸æ³³': 'ğŸŠ',
    'è·‘æ­¥': 'ğŸƒ',
    'å¥èº«': 'ğŸ’ª',
    'éŸ³ä¹': 'ğŸµ',
    'å”±æ­Œ': 'ğŸ¤',
    'è·³èˆ': 'ğŸ’ƒ',
    'ç”µå½±': 'ğŸ¬',
    'æ¸¸æˆ': 'ğŸ®',
    'ä¹¦': 'ğŸ“š',
    'ç”»ç”»': 'ğŸ¨',

    # ç‰©å“å’Œç¬¦å·
    'ç”µè¯': 'ğŸ“±',
    'ç”µè„‘': 'ğŸ’»',
    'ç›¸æœº': 'ğŸ“·',
    'é’±': 'ğŸ’°',
    'ç¤¼ç‰©': 'ğŸ',
    'æ°”çƒ': 'ğŸˆ',
    'æ——': 'ğŸš©',
    'é’¥åŒ™': 'ğŸ”‘',
    'ç¯æ³¡': 'ğŸ’¡',
    'é’Ÿ': 'ğŸ•',
    'æ—¶é—´': 'â°',
    'é‚®ä»¶': 'âœ‰ï¸',
    'ä¿¡': 'ğŸ’Œ',
    'å®¶': 'ğŸ ',
    'å­¦æ ¡': 'ğŸ«',
    'åŒ»é™¢': 'ğŸ¥',

    # æ‰‹åŠ¿å’Œäººç‰©
    'å¥½': 'ğŸ‘',
    'ç‚¹èµ': 'ğŸ‘',
    'èµ': 'ğŸ‘',
    'åŠ æ²¹': 'ğŸ’ª',
    'æ‹³å¤´': 'âœŠ',
    'ok': 'ğŸ‘Œ',
    'è€¶': 'âœŒï¸',
    'é¼“æŒ': 'ğŸ‘',
    'ç¥ˆç¥·': 'ğŸ™',
    'æ¡æ‰‹': 'ğŸ¤',
    'ç”·': 'ğŸ‘¨',
    'å¥³': 'ğŸ‘©',
    'å®å®': 'ğŸ‘¶',
    'è€äºº': 'ğŸ‘´',

    # ç¬¦å·
    'å¯¹': 'âœ…',
    'é”™': 'âŒ',
    'é—®': 'â“',
    'æ„Ÿå¹': 'â—',
    'è­¦å‘Š': 'âš ï¸',
    'ç¦æ­¢': 'ğŸš«',
    'ç®­å¤´': 'â¡ï¸',
    'å·¦': 'â¬…ï¸',
    'å³': 'â¡ï¸',
    'ä¸Š': 'â¬†ï¸',
    'ä¸‹': 'â¬‡ï¸',

    # æ•°å­—
    'ä¸€': '1ï¸âƒ£',
    'äºŒ': '2ï¸âƒ£',
    'ä¸‰': '3ï¸âƒ£',
    'å››': '4ï¸âƒ£',
    'äº”': '5ï¸âƒ£',
    'å…­': '6ï¸âƒ£',
    'ä¸ƒ': '7ï¸âƒ£',
    'å…«': '8ï¸âƒ£',
    'ä¹': '9ï¸âƒ£',
    'å': 'ğŸ”Ÿ',
    'é›¶': '0ï¸âƒ£',

    # æ—¶é—´ç›¸å…³
    'æ—©ä¸Š': 'ğŸŒ…',
    'ä¸­åˆ': 'â˜€ï¸',
    'æ™šä¸Š': 'ğŸŒ™',
    'å¤œæ™š': 'ğŸŒƒ',
    'ç”Ÿæ—¥': 'ğŸ‚',
    'èŠ‚æ—¥': 'ğŸ‰',
    'åº†ç¥': 'ğŸŠ',

    # å·¥ä½œå­¦ä¹ 
    'å·¥ä½œ': 'ğŸ’¼',
    'å­¦ä¹ ': 'ğŸ“–',
    'å†™': 'âœï¸',
    'ç¬”': 'âœ’ï¸',
    'æˆåŠŸ': 'ğŸ†',
    'ç›®æ ‡': 'ğŸ¯',
}


class TextToEmojiConverter:
    """æ–‡å­—è½¬ Emoji è½¬æ¢å™¨ç±»"""

    def __init__(self, emoji_map=None):
        """
        åˆå§‹åŒ–è½¬æ¢å™¨

        Args:
            emoji_map: è‡ªå®šä¹‰çš„ emoji æ˜ å°„å­—å…¸ï¼Œå¦‚æœä¸º None åˆ™ä½¿ç”¨é»˜è®¤å­—å…¸
        """
        self.emoji_map = emoji_map if emoji_map is not None else EMOJI_MAP
        # æŒ‰ç…§å…³é”®è¯é•¿åº¦æ’åºï¼Œç¡®ä¿ä¼˜å…ˆåŒ¹é…è¾ƒé•¿çš„å…³é”®è¯
        self.sorted_keywords = sorted(self.emoji_map.keys(), key=len, reverse=True)

    def convert(self, text, mode='append'):
        """
        å°†æ–‡æœ¬è½¬æ¢ä¸ºå¸¦ emoji çš„æ–‡æœ¬

        Args:
            text: è¾“å…¥çš„æ–‡æœ¬
            mode: è½¬æ¢æ¨¡å¼
                - 'append': åœ¨å…³é”®è¯åæ·»åŠ  emojiï¼ˆé»˜è®¤ï¼‰
                - 'replace': ç”¨ emoji æ›¿æ¢å…³é”®è¯
                - 'both': åŒæ—¶æ˜¾ç¤ºå…³é”®è¯å’Œ emoji

        Returns:
            è½¬æ¢åçš„æ–‡æœ¬
        """
        if not text:
            return text

        result = text
        replacements = []

        # æ‰¾å‡ºæ‰€æœ‰åŒ¹é…çš„å…³é”®è¯åŠå…¶ä½ç½®
        for keyword in self.sorted_keywords:
            start = 0
            while True:
                pos = result.find(keyword, start)
                if pos == -1:
                    break

                # æ£€æŸ¥æ˜¯å¦ä¸å·²æœ‰çš„æ›¿æ¢ä½ç½®é‡å 
                overlap = False
                for r_pos, r_len, _, _ in replacements:
                    if pos < r_pos + r_len and pos + len(keyword) > r_pos:
                        overlap = True
                        break

                if not overlap:
                    emoji = self.emoji_map[keyword]
                    replacements.append((pos, len(keyword), keyword, emoji))

                start = pos + 1

        # æŒ‰ä½ç½®å€’åºæ’åºï¼Œä»åå¾€å‰æ›¿æ¢ï¼Œé¿å…ä½ç½®åç§»
        replacements.sort(reverse=True)

        # æ‰§è¡Œæ›¿æ¢
        for pos, length, keyword, emoji in replacements:
            if mode == 'replace':
                # æ›¿æ¢æ¨¡å¼ï¼šç”¨ emoji æ›¿æ¢å…³é”®è¯
                result = result[:pos] + emoji + result[pos + length:]
            elif mode == 'both':
                # åŒæ—¶æ˜¾ç¤ºæ¨¡å¼ï¼šå…³é”®è¯(emoji)
                result = result[:pos] + f"{keyword}({emoji})" + result[pos + length:]
            else:  # append
                # è¿½åŠ æ¨¡å¼ï¼šå…³é”®è¯emoji
                result = result[:pos] + keyword + emoji + result[pos + length:]

        return result

    def get_emoji_count(self, text):
        """
        ç»Ÿè®¡æ–‡æœ¬ä¸­å¯ä»¥è½¬æ¢çš„å…³é”®è¯æ•°é‡

        Args:
            text: è¾“å…¥çš„æ–‡æœ¬

        Returns:
            å¯è½¬æ¢çš„å…³é”®è¯æ•°é‡
        """
        count = 0
        for keyword in self.emoji_map.keys():
            count += text.count(keyword)
        return count

    def list_keywords(self, category=None):
        """
        åˆ—å‡ºæ‰€æœ‰æ”¯æŒçš„å…³é”®è¯

        Args:
            category: åˆ†ç±»ï¼ˆæš‚æœªå®ç°ï¼‰

        Returns:
            å…³é”®è¯åˆ—è¡¨
        """
        return list(self.emoji_map.keys())


def main():
    """ä¸»å‡½æ•° - äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢"""
    converter = TextToEmojiConverter()

    print("=" * 50)
    print("âœ¨ æ–‡å­—è½¬ Emoji è½¬æ¢å™¨ âœ¨")
    print("=" * 50)
    print("\næ¬¢è¿ä½¿ç”¨æ–‡å­—è½¬ Emoji è½¬æ¢å™¨ï¼")
    print("è¾“å…¥æ–‡å­—ï¼Œæˆ‘ä¼šè‡ªåŠ¨è¯†åˆ«å…³é”®è¯å¹¶æ·»åŠ ç›¸åº”çš„ emoji è¡¨æƒ…\n")
    print("è½¬æ¢æ¨¡å¼ï¼š")
    print("  1. append  - åœ¨å…³é”®è¯åæ·»åŠ  emojiï¼ˆé»˜è®¤ï¼‰")
    print("  2. replace - ç”¨ emoji æ›¿æ¢å…³é”®è¯")
    print("  3. both    - åŒæ—¶æ˜¾ç¤ºå…³é”®è¯å’Œ emoji\n")
    print("å‘½ä»¤ï¼š")
    print("  /mode <æ¨¡å¼> - åˆ‡æ¢è½¬æ¢æ¨¡å¼")
    print("  /list        - æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„å…³é”®è¯")
    print("  /help        - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯")
    print("  /quit        - é€€å‡ºç¨‹åº\n")
    print("=" * 50 + "\n")

    current_mode = 'append'

    while True:
        try:
            user_input = input("è¯·è¾“å…¥æ–‡å­— > ").strip()

            if not user_input:
                continue

            # å¤„ç†å‘½ä»¤
            if user_input.startswith('/'):
                command_parts = user_input.split()
                command = command_parts[0].lower()

                if command == '/quit':
                    print("\næ„Ÿè°¢ä½¿ç”¨ï¼å†è§ ğŸ‘‹\n")
                    break

                elif command == '/help':
                    print("\nä½¿ç”¨è¯´æ˜ï¼š")
                    print("ç›´æ¥è¾“å…¥æ–‡å­—ï¼Œç¨‹åºä¼šè‡ªåŠ¨è¯†åˆ«å…³é”®è¯å¹¶è½¬æ¢ä¸º emoji")
                    print("ä¾‹å¦‚ï¼šæˆ‘ä»Šå¤©å¾ˆå¼€å¿ƒ â†’ æˆ‘ä»Šå¤©å¾ˆå¼€å¿ƒğŸ˜Š")
                    print()
                    continue

                elif command == '/list':
                    keywords = converter.list_keywords()
                    print(f"\næ”¯æŒ {len(keywords)} ä¸ªå…³é”®è¯ï¼š")
                    # æ¯è¡Œæ˜¾ç¤º 10 ä¸ª
                    for i in range(0, len(keywords), 10):
                        row = keywords[i:i+10]
                        print("  " + "ã€".join(row))
                    print()
                    continue

                elif command == '/mode':
                    if len(command_parts) < 2:
                        print(f"å½“å‰æ¨¡å¼ï¼š{current_mode}")
                        print("ä½¿ç”¨ /mode <append|replace|both> åˆ‡æ¢æ¨¡å¼\n")
                    else:
                        new_mode = command_parts[1].lower()
                        if new_mode in ['append', 'replace', 'both']:
                            current_mode = new_mode
                            print(f"å·²åˆ‡æ¢åˆ° {current_mode} æ¨¡å¼\n")
                        else:
                            print("æ— æ•ˆçš„æ¨¡å¼ï¼è¯·ä½¿ç”¨ appendã€replace æˆ– both\n")
                    continue

                else:
                    print(f"æœªçŸ¥å‘½ä»¤ï¼š{command}\n")
                    continue

            # è½¬æ¢æ–‡æœ¬
            result = converter.convert(user_input, mode=current_mode)
            emoji_count = converter.get_emoji_count(user_input)

            print(f"\nè½¬æ¢ç»“æœï¼š{result}")
            print(f"(æ‰¾åˆ° {emoji_count} ä¸ªå…³é”®è¯)\n")

        except KeyboardInterrupt:
            print("\n\nç¨‹åºå·²ä¸­æ–­ ğŸ‘‹\n")
            break
        except Exception as e:
            print(f"\nå‘ç”Ÿé”™è¯¯ï¼š{e}\n")


if __name__ == "__main__":
    main()
